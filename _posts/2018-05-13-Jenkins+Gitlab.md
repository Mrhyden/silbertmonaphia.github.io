---
published: false
---
* 目录
{:toc}

# 前言  
  终于有机会填坑了，Jekins这东西，从之前学习DevOps开始，一直就围绕这它打转，但是就是没有机会去自己亲手搭建一套，最近有机会自己去搭建一套Jenkins + Gitlab的自动发布流，花了好几天时间，踩了一些坑才把Jenkins有个稍微深入的认识  
  
#　Gitlab  
  在写Jekins之前，先聊聊Gitlab，Gitlab是类似Github的东西，不过虽然Github可以付费成为私有项目，但是对于公司而言，当然还是能把代码放在公司服务器就放在公司自己的服务器更好，因此就有了Gitlab，Gitlab的定位是私建的git repo,以前公司的选择是svn，但是现在越来越多的公司都转向git，那么就希望拥有svn一样私密的特性以及权限管理，所以就有了gitlab。其实我个人的理解很简单，如果是开源的，个人的项目，可以选择Github，如果是个人的而且又想私密的，可以Github付费或者国内的开源中国gitee可以免费建立私密项目，而自建的，那么就是Gitlab没跑了
  
#　Jenkins
  Gitlab的搭建我就不详细叙述了，根据官方的Tutorial一步步上就好了。而无论是gitlab,github,gitee，对于jenkins而言，就只是想要一个repo地址和Webhook，这三者都能提供。

## 安装  
  Jenkins的安装方法有很多，但是我最推荐的是直接jenkins.war来装，因为这个依赖最少，而且最简洁(深受"less is more"影响啊!)，启动直接`java -war jenkins -http-post=8080`即可，如果是想后台的，那么就`nohup java -war jenkins -http-post=8080 &`，对于本身是java的项目，还可以把jenkins.war包对劲Tomcat启动，但是由于自己现在的项目还是Python，服务器上面没有Tomcat之类的东西，所以就多一事不如少一事，保持简单最重要。  
  P.s.官方下载的jenkins的jenkins.war包装好以后竟然是中文的，有点小惊喜，我还想着怎么汉化，真不知道它是怎么检测系统环境的...  
  
##　插件  
  安装好以后就可以访问服务器的8080端口了，比如`http://you_servier_ip:8080`，开始初始化配置，一开始要输入一个管理员密码的，你按照提示到服务器上找就好了，然后还要选择默认插件安装，因为简洁哲学思想影响，默认的插件我插件都没有安装，因为它默认的安装的插件其实对于Jenkins + Gitlab完成自动部署任务来说，有一些不必要的～  
  那么我现在就告诉你，如果想达到" 能够git push到gitlab后，gitlab主动推送到Jenkins部署 "所必须的插件:　　

```
Requred:  
1.Git plugin
2.GitLab Plugin
3.Gitlab Hook Plugin
4.Email Extension Plugin(为了能够发送邮件)
5.SSH Slaves plugin(为了能够管理多个节点)

Optional:
1.Subversion Plug-in(如果托管在svn)
2.TODO Plugin(如果托管在gitee)
3.GitHub plugin(如果托管在github)
```

P.s.因为公司的服务器没有直接访问国外节点的能力，而我自己多次尝试更改为国内的比如清华开源镜像和搜狐开源镜像无果后(可以到[这里](http://mirrors.jenkins-ci.org/status.html)看一些jenkins插件的开源镜像站点)，果断转向自己上[官方插件站](https://plugins.jenkins.io/)去搜索相应的hpi，通过Archive跳转，在找到自己想要的版本来下载(其实这里应该贴图更好理解的，毕竟官方的指南也有点不清不楚...，但是原谅本人没有找到时间做博客的图床，所以一直就在尽力用文字描述清楚...)，下载下来后再上传到jenkins上即可

## 配置工程
   我看到有很多教程都要我们去系统配置里面去配置好再去配置工程，但是试验过后发现，就算没有去配置系统配置，但是在工程配置中配好就可以了，提一点，在没有安装插件的情况下，你新建工程，然后到工程的配置中发现，`源码管理`一栏中就只有"无"这个选项，而`构建触发器`这一栏则只有"触发远程构建 (例如,使用脚本)","其他工程构建后触发","定时构建"和"轮询 SCM"这四项，根本没有什么gitlab钩子什么的，所以所谓Jenkins的牛逼能力，从这点就能看出，都是出于丰富的插件生态，对各种玩法的支持上。  
   我稍微说说钩子(web hook)和"定时构建"以及"轮询 SCM"的区别，这几个对于刚接触jenkins的人而言是比较混淆的存在:  
   
```
1.定时构建:类似于linux的cron任务，一到时间无论代码库有无更新，都会从代码库拉取代码回来构建;
2.轮询SCM:写法也类似crontab，不过行为上和定时构建不一样，它是时间一到就会检查代码库的代码有没有更新，如果没有更新是不是拉取代码构建的，只有有更新了，才会拉取更新代码回来构建;
3.钩子:钩子可以说是触发器这里最佳选择了，上面的轮询的问题是一方面对代码库压力比较大，而且频率最快也只有1min一次，如果在1min的interval里面代码库有提交，那么还是得等完这一分钟才会由轮询方式来监测到代码更新从而触发构建行为，而钩子则改变了主动方，由jenkins主动定期检查代码库，变成代码库一旦监测到有更新，则主动告知jenkins去更新代码，这样就能解决刚才提到的两个问题了
```

   
  